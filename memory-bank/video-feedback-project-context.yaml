project_info:
  name: "video-crm-mvp"
  analyzed_at: "2026-02-16"
  tech_stack:
    framework: "Next.js 16.1.6, App Router (/app)"
    ui: "Tailwind CSS v4 + custom shadcn-style components + Radix UI primitives + Sonner"
    database: "Prisma 6 + PostgreSQL"
    auth: "Custom JWT auth (bcryptjs + jsonwebtoken), no Clerk/NextAuth"
    ai: "OpenAI SDK (openai package, chat.completions with model gpt-4o)"
    data_fetching: "SWR on dashboard/client pages"
    background_jobs: "BullMQ + ioredis"

file_structure:
  app_dirs:
    - "(auth)"
    - "(dashboard)"
    - "api"
    - "client-portal"
    - "public"
  app_router_hint: "App Router is used (no /pages directory)"
  components_dirs:
    - "components/auth"
    - "components/clients"
    - "components/feedback"
    - "components/layout"
    - "components/projects"
    - "components/scope"
    - "components/tasks"
    - "components/ui"
    - "components/video"
  app_api_routes:
    - "POST /api/ai/analyze-scope"
    - "POST /api/ai/generate-summary"
    - "POST /api/ai/parse-feedback"
    - "POST /api/auth/login"
    - "GET /api/auth/me"
    - "GET /api/auth/session"
    - "POST /api/auth/signup"
    - "GET,POST /api/clients"
    - "GET,PATCH,DELETE /api/clients/[id]"
    - "POST /api/feedback"
    - "PATCH,DELETE /api/feedback/[id]"
    - "GET /api/health"
    - "GET,POST /api/projects"
    - "GET,PATCH,DELETE /api/projects/[id]"
    - "GET /api/projects/[id]/feedback"
    - "GET,POST /api/projects/[id]/versions"
    - "GET /api/projects/[id]/workflow"
    - "GET /api/projects/[id]/workflow/metrics"
    - "POST /api/projects/[id]/workflow/transition"
    - "POST /api/public/feedback"
    - "POST /api/scope/analyze"
    - "GET /api/scope/decisions"
    - "POST /api/scope/decisions/[id]/decide"
    - "GET,POST /api/tasks"
    - "POST /api/tasks/from-feedback"
    - "GET,PATCH,DELETE /api/tasks/[id]"
    - "POST /api/upload"
    - "POST /api/upload/confirm"
    - "POST /api/webhooks/stripe"
  hooks_in_lib_hooks:
    - "use-auth-guard.ts (useAuthGuard)"
  utils_in_lib_utils:
    - "api-error.ts"
    - "auth.ts"
    - "client-api.ts"
    - "cn.ts"
    - "db.ts"
    - "errors.ts"
    - "http.ts"
    - "redis.ts"
    - "validation.ts"

database_schema:
  orm_file: "prisma/schema.prisma"
  models:
    User:
      fields:
        - "id, tenantId, role(OWNER|PM|EDITOR|CLIENT_VIEWER), firstName, lastName, email, passwordHash, isActive, createdAt, updatedAt"
      relations:
        - "N-1 Tenant via tenantId"
        - "M-N Project through ProjectMember"
        - "1-N AssetVersion (uploadedBy)"
        - "1-N FeedbackItem (author)"
        - "1-N AITask (assignedTo)"
        - "1-N ScopeDecision (pmUser)"
        - "1-N WorkflowStage (owner)"
    Project:
      fields:
        - "id, tenantId, clientAccountId, name, description, status, dueDate, budget, scopeDocUrl, maxRevisions, currentRevisionCount, createdAt, updatedAt"
      relations:
        - "N-1 Tenant"
        - "N-1 ClientAccount"
        - "1-N AssetVersion"
        - "M-N User through ProjectMember"
        - "1-N AITask"
        - "1-N ScopeDecision"
        - "1-N WorkflowStage"
    Asset:
      status: "Model Asset Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚; Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ AssetVersion ÐºÐ°Ðº Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ Ð²ÐµÑ€ÑÐ¸Ð¹"
    AssetVersion:
      fields:
        - "id, projectId, versionNo, fileUrl, fileKey, fileName, fileSize, durationSec, thumbnailUrl, uploadedByUserId, notes, createdAt"
      relations:
        - "N-1 Project"
        - "N-1 User (uploadedBy)"
        - "1-N FeedbackItem"
    Feedback:
      status: "ÐœÐ¾Ð´ÐµÐ»ÑŒ Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ FeedbackItem (Ð½Ðµ Feedback)"
      fields:
        - "id(uuid), assetVersionId, authorType(USER|CLIENT), authorId, authorEmail, authorName, timecodeSec, text, status, category, createdAt, updatedAt"
      relations:
        - "N-1 AssetVersion"
        - "N-1 User (optional author)"
        - "1-1 ScopeDecision (optional)"
    Comment:
      status: "ÐžÑ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð¼Ð¾Ð´ÐµÐ»Ð¸ Comment Ð½ÐµÑ‚"
  relations_summary:
    - "Tenant 1-N User"
    - "Tenant 1-N ClientAccount"
    - "Tenant 1-N Project"
    - "ClientAccount 1-N Project"
    - "Project 1-N AssetVersion"
    - "AssetVersion 1-N FeedbackItem"
    - "Project 1-N AITask"
    - "Project 1-N ScopeDecision"
    - "Project 1-N WorkflowStage"
    - "User N-N Project Ñ‡ÐµÑ€ÐµÐ· ProjectMember"
  foreign_keys:
    - "User.tenantId -> Tenant.id"
    - "ClientAccount.tenantId -> Tenant.id"
    - "Project.tenantId -> Tenant.id"
    - "Project.clientAccountId -> ClientAccount.id"
    - "ProjectMember.projectId -> Project.id"
    - "ProjectMember.userId -> User.id"
    - "AssetVersion.projectId -> Project.id"
    - "AssetVersion.uploadedByUserId -> User.id"
    - "FeedbackItem.assetVersionId -> AssetVersion.id"
    - "FeedbackItem.authorId -> User.id"
    - "AITask.projectId -> Project.id"
    - "AITask.assignedToUserId -> User.id"
    - "ScopeDecision.projectId -> Project.id"
    - "ScopeDecision.feedbackItemId -> FeedbackItem.id"
    - "ScopeDecision.decidedBy -> User.id"
    - "WorkflowStage.projectId -> Project.id"
    - "WorkflowStage.ownerUserId -> User.id"
    - "Notification.tenantId -> Tenant.id"
    - "Subscription.tenantId -> Tenant.id"
    - "AuditLog.tenantId -> Tenant.id"
  indexes_and_unique:
    - "User unique: (tenantId, email)"
    - "ProjectMember unique: (projectId, userId)"
    - "AssetVersion unique: (projectId, versionNo); index: uploadedByUserId"
    - "FeedbackItem indexes: assetVersionId, authorId, status"
    - "AITask indexes: projectId, assignedToUserId, status, priority"
    - "ScopeDecision unique: feedbackItemId; indexes: projectId, aiLabel, pmDecision"
    - "WorkflowStage unique: (projectId, stageName); indexes: projectId, stageName, startedAt"
    - "Notification indexes: tenantId, deliveryStatus, createdAt"
    - "Subscription unique: (tenantId, stripeSubscriptionId)"

existing_api:
  requested_endpoints:
    "GET /api/projects/[id]":
      exists: true
      auth: "Bearer token required via withAuth"
      returns: "ProjectResponse object from projectService.getProjectById(...)"
      response_shape: "raw JSON object (no {data} wrapper)"
    "POST /api/projects":
      exists: true
      auth: "Bearer token required"
      accepts:
        - "name: string(1..200)"
        - "clientId: string"
        - "description?: string"
        - "brief?: string"
        - "revisionsLimit?: int(1..10, default 3)"
      returns: "created project (201)"
    "GET /api/videos/[id]":
      exists: false
      note: "Ð’ app/api Ð½ÐµÑ‚ Ð¿Ð°Ð¿ÐºÐ¸ videos"
    "POST /api/feedback":
      exists: true
      auth: "Bearer token required"
      accepts:
        - "assetVersionId"
        - "authorType(USER|CLIENT)"
        - "authorId? / authorEmail? / authorName?"
        - "timecodeSec?"
        - "text"
        - "category?"
      returns: "created feedback item (201); also enqueues AI parse job"
  other_relevant_endpoints:
    - "GET /api/projects"
    - "PATCH,DELETE /api/projects/[id]"
    - "GET /api/projects/[id]/feedback"
    - "GET,POST /api/projects/[id]/versions"
    - "POST /api/upload + POST /api/upload/confirm"
    - "POST /api/ai/parse-feedback"
    - "POST /api/ai/generate-summary"
    - "POST /api/ai/analyze-scope"
    - "POST /api/tasks/from-feedback"
    - "POST /api/scope/analyze"
    - "GET /api/scope/decisions"
    - "POST /api/scope/decisions/[id]/decide"
  json_format:
    success_pattern: "Ð’ Ð±Ð¾Ð»ÑŒÑˆÐ¸Ð½ÑÑ‚Ð²Ðµ route: Response.json(payload) Ð±ÐµÐ· Ð¾Ð±ÐµÑ€Ñ‚ÐºÐ¸"
    alternative_pattern: "lib/utils/http.ts Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ { data } Ð¸ { error }, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ñ‚Ð¾Ñ‡ÐµÑ‡Ð½Ð¾ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ /api/health, stripe webhook)"
    error_pattern:
      - "ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¿ÑƒÑ‚ÑŒ: handleAPIError() -> { error, code? } Ð¸Ð»Ð¸ zod { error: 'Validation failed', issues }"
      - "Ð§Ð°ÑÑ‚ÑŒ route Ñ‡ÐµÑ€ÐµÐ· fail()/toApiError -> { error: { code, message, details? } }"
    note: "Ð•Ð´Ð¸Ð½Ñ‹Ð¹ ÑÑ‚Ñ€Ð¾Ð³Ð¸Ð¹ ÐºÐ¾Ð½Ñ‚Ñ€Ð°ÐºÑ‚ API-Ð¾Ð±ÐµÑ€Ñ‚ÐºÐ¸ Ð¿Ð¾ÐºÐ° Ð½Ðµ ÑƒÐ½Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ð½"

existing_components:
  ui:
    location: "components/ui"
    list:
      - "app-toaster"
      - "badge"
      - "button"
      - "card"
      - "dialog"
      - "input"
      - "label"
      - "select"
      - "textarea"
    patterns:
      - "Radix composition exports (Dialog, Select primitives)"
      - "class-variance-authority variants (Button)"
      - "asChild pattern via @radix-ui/react-slot"
  business:
    list:
      - "projects/ProjectCard"
      - "projects/ProjectForm"
      - "projects/WorkflowStages"
      - "feedback/FeedbackList"
      - "feedback/FeedbackForm (stub)"
      - "feedback/feedback-form (form implementation)"
      - "video/VideoPlayer (stub)"
      - "video/TimecodeComments (stub)"
      - "tasks/task-list"
      - "tasks/task-filters"
      - "tasks/task-card"
      - "scope/scope-decision-card"
  missing_for_video_feedback:
    - "Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹Ð¹ production VideoPlayer Ñ timeline/seek API (Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ VideoPlayer.tsx stub)"
    - "Ð’Ñ‹Ð´ÐµÐ»ÐµÐ½Ð½Ñ‹Ð¹ CommentsList/Timeline ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚ (ÐµÑÑ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ TimecodeComments stub)"
    - "Ð•Ð´Ð¸Ð½Ñ‹Ð¹ feedback UI ÑÐ»Ð¾Ð¹ Ð±ÐµÐ· Ð´ÑƒÐ±Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð¾Ð² FeedbackForm.tsx Ð¸ feedback-form.tsx"

existing_hooks:
  custom_hooks:
    - "useAuthGuard (lib/hooks/use-auth-guard.ts)"
  missing_requested_hooks:
    - "useUser: Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"
    - "useAuth (Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ð¹): Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚"
    - "useProjects: Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ ÐºÐ°Ðº custom hook"
    - "useFeedback: Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ ÐºÐ°Ðº custom hook"
  patterns:
    data_fetching: "SWR Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ð°Ñ…, Ð±ÐµÐ· Ð²Ñ‹Ð´ÐµÐ»ÐµÐ½Ð½Ñ‹Ñ… data hooks"
    state_management: "Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ React state + SWR cache, Ð±ÐµÐ· zustand/redux"
    context: "ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ñ‹Ð¹ React Context Ð´Ð»Ñ auth/data Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"

auth_system:
  provider: "Custom JWT (jsonwebtoken), login/signup endpoints Ð² /api/auth"
  user_check:
    api: "withAuth middleware Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Authorization Bearer token Ð¸ Ð²Ð°Ð»Ð¸Ð´Ð¸Ñ€ÑƒÐµÑ‚ Ñ‡ÐµÑ€ÐµÐ· authService.verifyToken"
    pages: "Dashboard layout Ð¾Ð±ÐµÑ€Ð½ÑƒÑ‚ Ð² client-side AuthGuard/useAuthGuard, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñ…Ð¾Ð´Ð¸Ñ‚ Ð² /api/auth/me"
  roles:
    source_enum: "Prisma UserRole"
    values:
      - "OWNER"
      - "PM"
      - "EDITOR"
      - "CLIENT_VIEWER"
  route_protection:
    protected: "ÐŸÐ¾Ñ‡Ñ‚Ð¸ Ð²ÑÐµ internal API Ñ‡ÐµÑ€ÐµÐ· withAuth"
    public:
      - "POST /api/auth/signup"
      - "POST /api/auth/login"
      - "POST /api/public/feedback"
      - "GET /api/health"
      - "POST /api/webhooks/stripe"
  authorization_notes:
    - "Ð¯Ð²Ð½Ð°Ñ role-Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð° Ð² POST /api/scope/decisions/[id]/decide (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ OWNER|PM)"
    - "Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Next middleware.ts Ð½ÐµÑ‚"

ai_integration:
  existing:
    - "lib/services/ai.service.ts"
    - "parseFeedback()"
    - "extractActionItems()"
    - "generateClientUpdate()"
    - "analyzeScopeCompliance()"
    - "generateChangeRequestTemplate()"
  not_implemented_methods:
    - "transcribeAudioFeedback()"
    - "categorizeFeedback()"
    - "estimateTaskPriority()"
    - "dedupeActionItems()"
  provider: "OpenAI API (openai chat.completions.create, model gpt-4o, response_format json_object)"
  rate_limiting: "Ð¯Ð²Ð½Ð¾Ð³Ð¾ rate limiting Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾"
  error_handling:
    - "normalizeOpenAIError Ð¼Ð°Ð¿Ð¿Ð¸Ñ‚ quota/auth/network ÑÐ»ÑƒÑ‡Ð°Ð¸"
    - "ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð¿Ñ€Ð¾Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÑŽÑ‚ÑÑ Ð² route Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ handleAPIError"
  integration_points:
    - "/api/ai/* routes"
    - "/api/tasks/from-feedback"
    - "/api/scope/analyze"
    - "background queue parse-feedback job"

file_storage:
  provider: "AWS S3 Ñ‡ÐµÑ€ÐµÐ· @aws-sdk/client-s3 + presigned URL"
  main_service: "lib/services/storage.service.ts"
  utility_file:
    lib_utils_upload_ts: "ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ (MISSING: lib/utils/upload.ts)"
  upload_flow:
    - "POST /api/upload -> getUploadUrl"
    - "client uploads directly to S3 via signed URL"
    - "POST /api/upload/confirm -> HeadObject validation"
  constraints:
    allowed_mime_types:
      - "video/mp4"
      - "video/quicktime"
      - "video/webm"
      - "video/avi"
    max_size_bytes: 5368709120
  env_keys:
    - "AWS_REGION"
    - "AWS_ACCESS_KEY_ID"
    - "AWS_SECRET_ACCESS_KEY"
    - "AWS_S3_BUCKET"

configuration:
  env_example_file: ".env.example"
  keys:
    database:
      - "DATABASE_URL"
      - "TEST_DATABASE_URL"
    auth:
      - "JWT_SECRET"
    ai:
      - "OPENAI_API_KEY"
    storage:
      - "AWS_REGION"
      - "AWS_ACCESS_KEY_ID"
      - "AWS_SECRET_ACCESS_KEY"
      - "AWS_S3_BUCKET"
    notifications:
      - "RESEND_API_KEY"
      - "NOTIFICATION_FROM_EMAIL"
    background_jobs:
      - "REDIS_HOST"
      - "REDIS_PORT"
      - "REDIS_PASSWORD"

testing:
  framework: "Vitest + supertest"
  config:
    environment: "node"
    include:
      - "tests/**/*.test.ts"
      - "lib/**/__tests__/**/*.test.ts"
  existing_tests:
    - "API tests: auth, clients, feedback, projects, tasks"
    - "Smoke tests: health/infrastructure"
    - "Service unit tests in lib/services/__tests__"
    - "Job handler tests in lib/jobs/__tests__"
  integration_level: "Ð•ÑÑ‚ÑŒ API integration-like Ñ‚ÐµÑÑ‚Ñ‹ Ñ‡ÐµÑ€ÐµÐ· supertest"
  test_containers: "ÐÐµ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹"

gaps_for_video_feedback_scope:
  missing_endpoints:
    - "GET /api/videos/[id]"
  missing_domain_models:
    - "Comment model"
    - "Asset base model (Ð²Ð¼ÐµÑÑ‚Ð¾ ÑÑ‚Ð¾Ð³Ð¾ AssetVersion)"
  missing_hooks:
    - "useProjects/useFeedback/useUser abstraction"
  missing_ai_features:
    - "audio transcription flow"
    - "feedback categorization helper method implementation"
  ui_gaps:
    - "VideoPlayer and TimecodeComments are stubs"

lessons_learned:
  - date: "2026-02-16"
    component: "useVoiceRecording"
    issue: "Speech API íå ïîääåðæèâàåòñÿ â iOS Safari"
    solution: "Àâòîìàòè÷åñêèé fallback íà MediaRecorder + Whisper API"
    code_snippet: |
      const hasSpeechAPI = !!(window.SpeechRecognition || window.webkitSpeechRecognition)
      if (!hasSpeechAPI) {
        await initMediaRecorder()
      }
    impact: "Êðèòè÷íî äëÿ iOS ïîëüçîâàòåëåé"

  - date: "2026-02-16"
    component: "useVoiceRecording"
    issue: "Memory leak ïðè unmount âî âðåìÿ çàïèñè"
    solution: "Cleanup â useEffect äëÿ recognition/recorder/timers"
    code_snippet: |
      useEffect(() => {
        return () => {
          recognitionRef.current?.stop()
          mediaRecorderRef.current?.stop()
          clearTimeout(autoStopTimerRef.current)
        }
      }, [])

  - date: "2026-02-16"
    component: "useVoiceRecording"
    issue: "Auto-stop ñðàáàòûâàåò ïðè ïàóçàõ â ðå÷è"
    solution: "Ñáðàñûâàòü òàéìåð ïðè êàæäîì ðåçóëüòàòå"
    tuning: "autoStopTimeout = 3000ms"

common_bugs:
  - bug: "MediaRecorder audio chunks íå î÷èùàþòñÿ"
    fix: "chunks.length = 0 ïîñëå îòïðàâêè"

  - bug: "Permission denied íå îáðàáàòûâàåòñÿ"
    fix: "try/catch äëÿ getUserMedia + error state"

  - bug: "Speech Recognition ïîñëå unmount"
    fix: "Cleanup â useEffect"

abstractions:
  voice_recording:
    file: "lib/hooks/useVoiceRecording.ts"
    primary: "Web Speech API (Chrome/Edge)"
    fallback: "MediaRecorder + Whisper (iOS/Firefox)"
    key_methods: ["startRecording", "stopRecording", "handleSpeechResult"]
    dependencies: ["/api/ai/transcribe-audio"]

coding_patterns:
  audio_recording:
    - "Ïðîâåðÿòü ïîääåðæêó API (checkSupport)"
    - "useRef äëÿ SpeechRecognition/MediaRecorder"
    - "Cleanup: stop recognition/recorder + clear timers"
    - "Fallback strategy: Speech API -> MediaRecorder -> Manual"

use_comments_stab_2026_02_16:
  lessons_learned:
    - issue: "SWR cache leakage made hook tests flaky across cases"
      solution: "Wrap each renderHook with SWRConfig provider: () => new Map()"
      impact: "High"
    - issue: "Immediate revalidate after optimistic success can override local state"
      solution: "Keep optimistic state on success and use manual refresh for server sync"
      impact: "Critical UX"
    - issue: "Abort on unmount can surface as unhandled promise in fire-and-forget calls"
      solution: "Treat cancellation as silent when component is already unmounted"
      impact: "Medium"
  common_bugs:
    - bug: "Shared SWR cache between tests"
      fix: "Isolated provider map per test"
    - bug: "Optimistic CRUD auto-rollback right after success"
      fix: "Avoid forced revalidate on mutation success"
    - bug: "AbortError after unmount"
      fix: "Handle cancellation branch without throwing"
  abstractions:
    file: "lib/hooks/useComments.ts"
    responsibilities:
      - "SWR fetch + cache"
      - "Optimistic add/update/delete with rollback"
      - "filter/sort pipeline"
      - "request timeout/retry + abort cleanup"
  coding_patterns:
    - "useCallback for all public operations"
    - "useMemo for processed comments"
    - "inflight mutation dedup by key"
    - "input validation before network"
